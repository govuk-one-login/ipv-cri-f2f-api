name: Pull Request CI - Sonar
on:
  workflow_dispatch:
  pull_request:
    types:
      - opened
      - reopened
      - ready_for_review
      - synchronize

jobs:
  unit-tests:
        uses: ./.github/workflows/run-unit-tests.yml
        with:
          coverage-report: true
  run-sonar-pr:
    name: run-sonar-pr
    needs: unit-tests
    runs-on: ubuntu-latest
    steps:
      - name: Run SonarCloud scan
        if: ${{ github.actor != 'dependabot[bot]' }}
        uses: govuk-one-login/github-actions/code-quality/sonarcloud@7bc197778553493ca4c6fb4a78caf3cfd03f8ccb
        with:
          coverage-location: coverage
          github-token: ${{ secrets.GITHUB_TOKEN }}
          sonar-token: ${{ secrets.SONAR_TOKEN }}
